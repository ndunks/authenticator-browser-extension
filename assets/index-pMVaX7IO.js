var Se=Object.defineProperty;var Ae=(r,e,n)=>e in r?Se(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var I=(r,e,n)=>Ae(r,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const ie=`<form id="add-item" class="form-card" onsubmit="return false">
  <label>
    Name: <input type="text" name="name" required>
  </label><br>

  <label>
    Issuer: <input type="text" name="issuer" required>
  </label><br>

  <label>
    Secret (base32): <input type="text" name="secret" required>
  </label><br>

  <label>
    Algorithm:
    <select name="algorithm">
      <option value="1" selected>SHA1</option>
      <option value="2">SHA256</option>
      <option value="3">SHA512</option>
      <option value="4">MD5</option>
    </select>
  </label><br>

  <label>
    Type:
    <select name="type">
      <option value="1">HOTP</option>
      <option value="2" selected>TOTP</option>
    </select>
  </label><br>

  <label>
    Digits:
    <select name="digits">
      <option value="6" selected>6</option>
      <option value="8">8</option>
    </select>
  </label><br>

  <label>
    Counter (only for HOTP): <input type="number" name="counter">
  </label><br>
  <hr/>
  <label>
    Password (if set): <input autocomplete="new-password" type="password" name="password">
  </label><br>
  <button type="submit">Submit</button>
</form>`;let Ee=class{constructor(){I(this,"title","Add Item");I(this,"content",ie)}onShow(e){const n=e.body.querySelector("#add-item");n.addEventListener("submit",t=>{t.preventDefault();const s=Object.fromEntries(new FormData(n).entries());appStorage.createItem(s,s.password.toString()).then(()=>location.reload()).catch(o=>alert(o.message||o))})}};const Ne=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"})),He=`<form id="change-password" class="form-card" onsubmit="return false">
  <label>
    Current Password: <input type="password" name="current_password">
  </label><br>

  <label>
    New Password: <input type="password" name="new_password1">
  </label><br>

  <label>
    Repeat New Password: <input type="password" name="new_password2">
  </label><br>

  <button type="submit">Submit</button>
</form>`;class Te{constructor(){I(this,"title","Change Password");I(this,"content",He)}onShow(e){const n=e.body.querySelector("#change-password");n.addEventListener("submit",t=>{t.preventDefault();const s=new FormData(n),o=Object.fromEntries(s.entries());if(o.new_password1!==o.new_password2)return alert("New passwords does not match");if(o.new_password1===o.current_password)return alert("No change");appStorage.changePassword(o.current_password.toString(),o.new_password1.toString()).then(()=>{alert("Password changed"),location.reload()}).catch(i=>{alert(`Failed: ${i.message||i}`)})})}}const Le=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));class Ce{constructor(){I(this,"title","Edit Item");I(this,"content",ie.replace('<button type="submit">Submit</button>','<button type="submit">Submit</button><button id="delete-item" type="button" style="background-color: red; float: right" class="btn">DELETE</button>'));I(this,"form")}onShow(e,n){const t=appStorage.cached.filter(s=>!!s).find(s=>s.id==n.id);console.log("EDIT",n,t),t&&(this.form=e.body.querySelector("#add-item"),this.form.querySelector("#delete-item").addEventListener("click",s=>{confirm("Delete this item?")&&appStorage.removeItem(n.id).then(()=>location.reload()).catch(o=>alert(o.message||o))}),this.form.addEventListener("submit",s=>{s.preventDefault();const o=Object.fromEntries(new FormData(this.form).entries());appStorage.updateItem(n.id,o,o.password.toString()).then(()=>location.reload()).catch(i=>alert(i.message||i))}),this.applyFormValues(t))}applyFormValues(e){for(const[n,t]of Object.entries(e)){const s=this.form.elements.namedItem(n);!s||t===void 0||t===null||(s instanceof HTMLInputElement||s instanceof HTMLSelectElement)&&(s.value=String(t))}}}const Me=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"})),Ue="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split("");function Re(r){const e=[];for(let s in r){const o=r[s].toString(2);let i=8-o.length,u="";for(let l=0;l<i;l++)u="0"+u;e.push(u+o)}let n=e.join(""),t=[];for(let s=0;s<n.length;s+=5){let o=n.substring(s,s+5);if(o.length<5){let u=5-o.length,l="";for(let h=0;h<u;h++)l+="0";o+=l}let i=parseInt(o,2);t.push(Ue[i])}if(t.length%8!=0){let s=8-t.length%8;for(let o=0;o<s;o++)t.push("=")}return t.join("")}function z(){const r=Date.now(),e=Math.floor(Math.random()*1e6),n=BigInt(r)*BigInt(1e6)+BigInt(e);return Math.floor(Math.random()*1e4).toString(36)+n.toString(36)}function Ke(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;n++)e[n]=r.charCodeAt(n);return e}function P(r,e){let n=0,t=0,s=0;for(;;){const o=r[e++];if(s++,n|=(o&127)<<t,(o&128)===0)break;t+=7}return{value:n,length:s}}function ae(r){let e=0;const n=[];for(;e<r.length;){const t=r[e++],s=t>>3,o=t&7;if(s!==1){if(o===0){const{value:c,length:f}=P(r,e);console.warn(`Skipped field ${s} with int value: ${c}`),e+=f}else if(o===2){const{value:c,length:f}=P(r,e);console.warn(`Skipped field ${s} with value len: ${c}`),e+=f+c}else throw new Error(`Unsupported wire type: ${o}`);continue}if(o!==2)throw new Error(`Got fieldNum 1 but have invalid wireType: ${o}`);const{value:i,length:u}=P(r,e);e+=u;const l=r.slice(e,e+i);e+=i;let h=0;const d={};for(d.id=z();h<l.length;){const c=l[h++],f=c>>3,g=c&7;if(g===2){const{value:p,length:m}=P(l,h);h+=m;const b=l.slice(h,h+p);h+=p;const y=new TextDecoder().decode(b);f===1&&(d.secret=Re(b)),f===2&&(d.name=y),f===3&&(d.issuer=y)}else if(g===0){const{value:p,length:m}=P(l,h);h+=m,f===4&&(d.algorithm=p),f===5&&(d.digits=p===1?6:8),f===6&&(d.type=p),f===7&&(d.counter=p)}}n.push(d)}return n}const _e=`<div id="setting" class="tab">
    <textarea id="data" rows="10"></textarea>
    <input placeholder="Password" id="setPassword" value="" />
    <button id="btnSave">Save</button>
</div>`;class Pe{constructor(){I(this,"title","Import Accounts");I(this,"content",_e)}onShow(e){const n=e.body.querySelector("#btnSave"),t=e.body.querySelector("#setPassword"),s=e.body.querySelector("#data");n.addEventListener("click",async()=>{const o=ae(Ke(s.value));await appStorage.addItems(o,t.value).then(()=>location.reload())})}}const Be=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));var q=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.SHA1=1]="SHA1",r[r.SHA256=2]="SHA256",r[r.SHA512=3]="SHA512",r[r.MD5=4]="MD5",r))(q||{}),ce=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.HOTP=1]="HOTP",r[r.TOTP=2]="TOTP",r))(ce||{});const le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ue="ARRAYBUFFER not supported by this environment",he="UINT8ARRAY not supported by this environment";function G(r,e,n,t){let s,o,i;const u=e||[0],l=(n=n||0)>>>3,h=t===-1?3:0;for(s=0;s<r.length;s+=1)i=s+l,o=i>>>2,u.length<=o&&u.push(0),u[o]|=r[s]<<8*(h+t*(i%4));return{value:u,binLen:8*r.length+n}}function _(r,e,n){switch(e){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(r){case"HEX":return function(t,s,o){return function(i,u,l,h){let d,c,f,g;if(i.length%2!=0)throw new Error("String of HEX type must be in byte increments");const p=u||[0],m=(l=l||0)>>>3,b=h===-1?3:0;for(d=0;d<i.length;d+=2){if(c=parseInt(i.substr(d,2),16),isNaN(c))throw new Error("String of HEX type contains invalid characters");for(g=(d>>>1)+m,f=g>>>2;p.length<=f;)p.push(0);p[f]|=c<<8*(b+h*(g%4))}return{value:p,binLen:4*i.length+l}}(t,s,o,n)};case"TEXT":return function(t,s,o){return function(i,u,l,h,d){let c,f,g,p,m,b,y,v,E=0;const A=l||[0],N=(h=h||0)>>>3;if(u==="UTF8")for(y=d===-1?3:0,g=0;g<i.length;g+=1)for(c=i.charCodeAt(g),f=[],128>c?f.push(c):2048>c?(f.push(192|c>>>6),f.push(128|63&c)):55296>c||57344<=c?f.push(224|c>>>12,128|c>>>6&63,128|63&c):(g+=1,c=65536+((1023&c)<<10|1023&i.charCodeAt(g)),f.push(240|c>>>18,128|c>>>12&63,128|c>>>6&63,128|63&c)),p=0;p<f.length;p+=1){for(b=E+N,m=b>>>2;A.length<=m;)A.push(0);A[m]|=f[p]<<8*(y+d*(b%4)),E+=1}else for(y=d===-1?2:0,v=u==="UTF16LE"&&d!==1||u!=="UTF16LE"&&d===1,g=0;g<i.length;g+=1){for(c=i.charCodeAt(g),v===!0&&(p=255&c,c=p<<8|c>>>8),b=E+N,m=b>>>2;A.length<=m;)A.push(0);A[m]|=c<<8*(y+d*(b%4)),E+=2}return{value:A,binLen:8*E+h}}(t,e,s,o,n)};case"B64":return function(t,s,o){return function(i,u,l,h){let d,c,f,g,p,m,b,y=0;const v=u||[0],E=(l=l||0)>>>3,A=h===-1?3:0,N=i.indexOf("=");if(i.search(/^[a-zA-Z0-9=+/]+$/)===-1)throw new Error("Invalid character in base-64 string");if(i=i.replace(/=/g,""),N!==-1&&N<i.length)throw new Error("Invalid '=' found in base-64 string");for(c=0;c<i.length;c+=4){for(p=i.substr(c,4),g=0,f=0;f<p.length;f+=1)d=le.indexOf(p.charAt(f)),g|=d<<18-6*f;for(f=0;f<p.length-1;f+=1){for(b=y+E,m=b>>>2;v.length<=m;)v.push(0);v[m]|=(g>>>16-8*f&255)<<8*(A+h*(b%4)),y+=1}}return{value:v,binLen:8*y+l}}(t,s,o,n)};case"BYTES":return function(t,s,o){return function(i,u,l,h){let d,c,f,g;const p=u||[0],m=(l=l||0)>>>3,b=h===-1?3:0;for(c=0;c<i.length;c+=1)d=i.charCodeAt(c),g=c+m,f=g>>>2,p.length<=f&&p.push(0),p[f]|=d<<8*(b+h*(g%4));return{value:p,binLen:8*i.length+l}}(t,s,o,n)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(ue)}return function(t,s,o){return function(i,u,l,h){return G(new Uint8Array(i),u,l,h)}(t,s,o,n)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(he)}return function(t,s,o){return G(t,s,o,n)};default:throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function V(r,e,n,t){switch(r){case"HEX":return function(s){return function(o,i,u,l){const h="0123456789abcdef";let d,c,f="";const g=i/8,p=u===-1?3:0;for(d=0;d<g;d+=1)c=o[d>>>2]>>>8*(p+u*(d%4)),f+=h.charAt(c>>>4&15)+h.charAt(15&c);return l.outputUpper?f.toUpperCase():f}(s,e,n,t)};case"B64":return function(s){return function(o,i,u,l){let h,d,c,f,g,p="";const m=i/8,b=u===-1?3:0;for(h=0;h<m;h+=3)for(f=h+1<m?o[h+1>>>2]:0,g=h+2<m?o[h+2>>>2]:0,c=(o[h>>>2]>>>8*(b+u*(h%4))&255)<<16|(f>>>8*(b+u*((h+1)%4))&255)<<8|g>>>8*(b+u*((h+2)%4))&255,d=0;d<4;d+=1)p+=8*h+6*d<=i?le.charAt(c>>>6*(3-d)&63):l.b64Pad;return p}(s,e,n,t)};case"BYTES":return function(s){return function(o,i,u){let l,h,d="";const c=i/8,f=u===-1?3:0;for(l=0;l<c;l+=1)h=o[l>>>2]>>>8*(f+u*(l%4))&255,d+=String.fromCharCode(h);return d}(s,e,n)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(ue)}return function(s){return function(o,i,u){let l;const h=i/8,d=new ArrayBuffer(h),c=new Uint8Array(d),f=u===-1?3:0;for(l=0;l<h;l+=1)c[l]=o[l>>>2]>>>8*(f+u*(l%4))&255;return d}(s,e,n)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(he)}return function(s){return function(o,i,u){let l;const h=i/8,d=u===-1?3:0,c=new Uint8Array(h);for(l=0;l<h;l+=1)c[l]=o[l>>>2]>>>8*(d+u*(l%4))&255;return c}(s,e,n)};default:throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}const D=4294967296,w=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],C=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],M=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],x="Chosen SHA variant is not supported",fe="Cannot set numRounds with MAC";function j(r,e){let n,t;const s=r.binLen>>>3,o=e.binLen>>>3,i=s<<3,u=4-s<<3;if(s%4!=0){for(n=0;n<o;n+=4)t=s+n>>>2,r.value[t]|=e.value[n>>>2]<<i,r.value.push(0),r.value[t+1]|=e.value[n>>>2]>>>u;return(r.value.length<<2)-4>=o+s&&r.value.pop(),{value:r.value,binLen:r.binLen+e.binLen}}return{value:r.value.concat(e.value),binLen:r.binLen+e.binLen}}function W(r){const e={outputUpper:!1,b64Pad:"=",outputLen:-1},n=r||{},t="Output length must be a multiple of 8";if(e.outputUpper=n.outputUpper||!1,n.b64Pad&&(e.b64Pad=n.b64Pad),n.outputLen){if(n.outputLen%8!=0)throw new Error(t);e.outputLen=n.outputLen}else if(n.shakeLen){if(n.shakeLen%8!=0)throw new Error(t);e.outputLen=n.shakeLen}if(typeof e.outputUpper!="boolean")throw new Error("Invalid outputUpper formatting option");if(typeof e.b64Pad!="string")throw new Error("Invalid b64Pad formatting option");return e}function U(r,e,n,t){const s=r+" must include a value and format";if(!e){if(!t)throw new Error(s);return t}if(e.value===void 0||!e.format)throw new Error(s);return _(e.format,e.encoding||"UTF8",n)(e.value)}class Y{constructor(e,n,t){const s=t||{};if(this.t=n,this.i=s.encoding||"UTF8",this.numRounds=s.numRounds||1,isNaN(this.numRounds)||this.numRounds!==parseInt(this.numRounds,10)||1>this.numRounds)throw new Error("numRounds must a integer >= 1");this.o=e,this.h=[],this.u=0,this.l=!1,this.A=0,this.H=!1,this.S=[],this.p=[]}update(e){let n,t=0;const s=this.m>>>5,o=this.C(e,this.h,this.u),i=o.binLen,u=o.value,l=i>>>5;for(n=0;n<l;n+=s)t+this.m<=i&&(this.U=this.v(u.slice(n,n+s),this.U),t+=this.m);return this.A+=t,this.h=u.slice(t>>>5),this.u=i%this.m,this.l=!0,this}getHash(e,n){let t,s,o=this.R;const i=W(n);if(this.K){if(i.outputLen===-1)throw new Error("Output length must be specified in options");o=i.outputLen}const u=V(e,o,this.T,i);if(this.H&&this.g)return u(this.g(i));for(s=this.F(this.h.slice(),this.u,this.A,this.L(this.U),o),t=1;t<this.numRounds;t+=1)this.K&&o%32!=0&&(s[s.length-1]&=16777215>>>24-o%32),s=this.F(s,o,0,this.B(this.o),o);return u(s)}setHMACKey(e,n,t){if(!this.M)throw new Error("Variant does not support HMAC");if(this.l)throw new Error("Cannot set MAC key after calling update");const s=_(n,(t||{}).encoding||"UTF8",this.T);this.k(s(e))}k(e){const n=this.m>>>3,t=n/4-1;let s;if(this.numRounds!==1)throw new Error(fe);if(this.H)throw new Error("MAC key already set");for(n<e.binLen/8&&(e.value=this.F(e.value,e.binLen,0,this.B(this.o),this.R));e.value.length<=t;)e.value.push(0);for(s=0;s<=t;s+=1)this.S[s]=909522486^e.value[s],this.p[s]=1549556828^e.value[s];this.U=this.v(this.S,this.U),this.A=this.m,this.H=!0}getHMAC(e,n){const t=W(n);return V(e,this.R,this.T,t)(this.Y())}Y(){let e;if(!this.H)throw new Error("Cannot call getHMAC without first setting MAC key");const n=this.F(this.h.slice(),this.u,this.A,this.L(this.U),this.R);return e=this.v(this.p,this.B(this.o)),e=this.F(n,this.R,this.m,e,this.R),e}}function R(r,e){return r<<e|r>>>32-e}function T(r,e){return r>>>e|r<<32-e}function de(r,e){return r>>>e}function J(r,e,n){return r^e^n}function we(r,e,n){return r&e^~r&n}function pe(r,e,n){return r&e^r&n^e&n}function ke(r){return T(r,2)^T(r,13)^T(r,22)}function S(r,e){const n=(65535&r)+(65535&e);return(65535&(r>>>16)+(e>>>16)+(n>>>16))<<16|65535&n}function De(r,e,n,t){const s=(65535&r)+(65535&e)+(65535&n)+(65535&t);return(65535&(r>>>16)+(e>>>16)+(n>>>16)+(t>>>16)+(s>>>16))<<16|65535&s}function k(r,e,n,t,s){const o=(65535&r)+(65535&e)+(65535&n)+(65535&t)+(65535&s);return(65535&(r>>>16)+(e>>>16)+(n>>>16)+(t>>>16)+(s>>>16)+(o>>>16))<<16|65535&o}function xe(r){return T(r,7)^T(r,18)^de(r,3)}function Fe(r){return T(r,6)^T(r,11)^T(r,25)}function Oe(r){return[1732584193,4023233417,2562383102,271733878,3285377520]}function ge(r,e){let n,t,s,o,i,u,l;const h=[];for(n=e[0],t=e[1],s=e[2],o=e[3],i=e[4],l=0;l<80;l+=1)h[l]=l<16?r[l]:R(h[l-3]^h[l-8]^h[l-14]^h[l-16],1),u=l<20?k(R(n,5),we(t,s,o),i,1518500249,h[l]):l<40?k(R(n,5),J(t,s,o),i,1859775393,h[l]):l<60?k(R(n,5),pe(t,s,o),i,2400959708,h[l]):k(R(n,5),J(t,s,o),i,3395469782,h[l]),i=o,o=s,s=R(t,30),t=n,n=u;return e[0]=S(n,e[0]),e[1]=S(t,e[1]),e[2]=S(s,e[2]),e[3]=S(o,e[3]),e[4]=S(i,e[4]),e}function je(r,e,n,t){let s;const o=15+(e+65>>>9<<4),i=e+n;for(;r.length<=o;)r.push(0);for(r[e>>>5]|=128<<24-e%32,r[o]=4294967295&i,r[o-1]=i/D|0,s=0;s<r.length;s+=16)t=ge(r.slice(s,s+16),t);return t}let Ye=class extends Y{constructor(r,e,n){if(r!=="SHA-1")throw new Error(x);super(r,e,n);const t=n||{};this.M=!0,this.g=this.Y,this.T=-1,this.C=_(this.t,this.i,this.T),this.v=ge,this.L=function(s){return s.slice()},this.B=Oe,this.F=je,this.U=[1732584193,4023233417,2562383102,271733878,3285377520],this.m=512,this.R=160,this.K=!1,t.hmacKey&&this.k(U("hmacKey",t.hmacKey,this.T))}};function Z(r){let e;return e=r=="SHA-224"?C.slice():M.slice(),e}function Q(r,e){let n,t,s,o,i,u,l,h,d,c,f;const g=[];for(n=e[0],t=e[1],s=e[2],o=e[3],i=e[4],u=e[5],l=e[6],h=e[7],f=0;f<64;f+=1)g[f]=f<16?r[f]:De(T(p=g[f-2],17)^T(p,19)^de(p,10),g[f-7],xe(g[f-15]),g[f-16]),d=k(h,Fe(i),we(i,u,l),w[f],g[f]),c=S(ke(n),pe(n,t,s)),h=l,l=u,u=i,i=S(o,d),o=s,s=t,t=n,n=S(d,c);var p;return e[0]=S(n,e[0]),e[1]=S(t,e[1]),e[2]=S(s,e[2]),e[3]=S(o,e[3]),e[4]=S(i,e[4]),e[5]=S(u,e[5]),e[6]=S(l,e[6]),e[7]=S(h,e[7]),e}let Xe=class extends Y{constructor(r,e,n){if(r!=="SHA-224"&&r!=="SHA-256")throw new Error(x);super(r,e,n);const t=n||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=_(this.t,this.i,this.T),this.v=Q,this.L=function(s){return s.slice()},this.B=Z,this.F=function(s,o,i,u){return function(l,h,d,c,f){let g,p;const m=15+(h+65>>>9<<4),b=h+d;for(;l.length<=m;)l.push(0);for(l[h>>>5]|=128<<24-h%32,l[m]=4294967295&b,l[m-1]=b/D|0,g=0;g<l.length;g+=16)c=Q(l.slice(g,g+16),c);return p=f==="SHA-224"?[c[0],c[1],c[2],c[3],c[4],c[5],c[6]]:c,p}(s,o,i,u,r)},this.U=Z(r),this.m=512,this.R=r==="SHA-224"?224:256,this.K=!1,t.hmacKey&&this.k(U("hmacKey",t.hmacKey,this.T))}};class a{constructor(e,n){this.N=e,this.I=n}}function ee(r,e){let n;return e>32?(n=64-e,new a(r.I<<e|r.N>>>n,r.N<<e|r.I>>>n)):e!==0?(n=32-e,new a(r.N<<e|r.I>>>n,r.I<<e|r.N>>>n)):r}function L(r,e){let n;return e<32?(n=32-e,new a(r.N>>>e|r.I<<n,r.I>>>e|r.N<<n)):(n=64-e,new a(r.I>>>e|r.N<<n,r.N>>>e|r.I<<n))}function me(r,e){return new a(r.N>>>e,r.I>>>e|r.N<<32-e)}function ze(r,e,n){return new a(r.N&e.N^r.N&n.N^e.N&n.N,r.I&e.I^r.I&n.I^e.I&n.I)}function qe(r){const e=L(r,28),n=L(r,34),t=L(r,39);return new a(e.N^n.N^t.N,e.I^n.I^t.I)}function H(r,e){let n,t;n=(65535&r.I)+(65535&e.I),t=(r.I>>>16)+(e.I>>>16)+(n>>>16);const s=(65535&t)<<16|65535&n;return n=(65535&r.N)+(65535&e.N)+(t>>>16),t=(r.N>>>16)+(e.N>>>16)+(n>>>16),new a((65535&t)<<16|65535&n,s)}function $e(r,e,n,t){let s,o;s=(65535&r.I)+(65535&e.I)+(65535&n.I)+(65535&t.I),o=(r.I>>>16)+(e.I>>>16)+(n.I>>>16)+(t.I>>>16)+(s>>>16);const i=(65535&o)<<16|65535&s;return s=(65535&r.N)+(65535&e.N)+(65535&n.N)+(65535&t.N)+(o>>>16),o=(r.N>>>16)+(e.N>>>16)+(n.N>>>16)+(t.N>>>16)+(s>>>16),new a((65535&o)<<16|65535&s,i)}function Ge(r,e,n,t,s){let o,i;o=(65535&r.I)+(65535&e.I)+(65535&n.I)+(65535&t.I)+(65535&s.I),i=(r.I>>>16)+(e.I>>>16)+(n.I>>>16)+(t.I>>>16)+(s.I>>>16)+(o>>>16);const u=(65535&i)<<16|65535&o;return o=(65535&r.N)+(65535&e.N)+(65535&n.N)+(65535&t.N)+(65535&s.N)+(i>>>16),i=(r.N>>>16)+(e.N>>>16)+(n.N>>>16)+(t.N>>>16)+(s.N>>>16)+(o>>>16),new a((65535&i)<<16|65535&o,u)}function B(r,e){return new a(r.N^e.N,r.I^e.I)}function Ve(r){const e=L(r,19),n=L(r,61),t=me(r,6);return new a(e.N^n.N^t.N,e.I^n.I^t.I)}function We(r){const e=L(r,1),n=L(r,8),t=me(r,7);return new a(e.N^n.N^t.N,e.I^n.I^t.I)}function Je(r){const e=L(r,14),n=L(r,18),t=L(r,41);return new a(e.N^n.N^t.N,e.I^n.I^t.I)}const Ze=[new a(w[0],3609767458),new a(w[1],602891725),new a(w[2],3964484399),new a(w[3],2173295548),new a(w[4],4081628472),new a(w[5],3053834265),new a(w[6],2937671579),new a(w[7],3664609560),new a(w[8],2734883394),new a(w[9],1164996542),new a(w[10],1323610764),new a(w[11],3590304994),new a(w[12],4068182383),new a(w[13],991336113),new a(w[14],633803317),new a(w[15],3479774868),new a(w[16],2666613458),new a(w[17],944711139),new a(w[18],2341262773),new a(w[19],2007800933),new a(w[20],1495990901),new a(w[21],1856431235),new a(w[22],3175218132),new a(w[23],2198950837),new a(w[24],3999719339),new a(w[25],766784016),new a(w[26],2566594879),new a(w[27],3203337956),new a(w[28],1034457026),new a(w[29],2466948901),new a(w[30],3758326383),new a(w[31],168717936),new a(w[32],1188179964),new a(w[33],1546045734),new a(w[34],1522805485),new a(w[35],2643833823),new a(w[36],2343527390),new a(w[37],1014477480),new a(w[38],1206759142),new a(w[39],344077627),new a(w[40],1290863460),new a(w[41],3158454273),new a(w[42],3505952657),new a(w[43],106217008),new a(w[44],3606008344),new a(w[45],1432725776),new a(w[46],1467031594),new a(w[47],851169720),new a(w[48],3100823752),new a(w[49],1363258195),new a(w[50],3750685593),new a(w[51],3785050280),new a(w[52],3318307427),new a(w[53],3812723403),new a(w[54],2003034995),new a(w[55],3602036899),new a(w[56],1575990012),new a(w[57],1125592928),new a(w[58],2716904306),new a(w[59],442776044),new a(w[60],593698344),new a(w[61],3733110249),new a(w[62],2999351573),new a(w[63],3815920427),new a(3391569614,3928383900),new a(3515267271,566280711),new a(3940187606,3454069534),new a(4118630271,4000239992),new a(116418474,1914138554),new a(174292421,2731055270),new a(289380356,3203993006),new a(460393269,320620315),new a(685471733,587496836),new a(852142971,1086792851),new a(1017036298,365543100),new a(1126000580,2618297676),new a(1288033470,3409855158),new a(1501505948,4234509866),new a(1607167915,987167468),new a(1816402316,1246189591)];function te(r){return r==="SHA-384"?[new a(3418070365,C[0]),new a(1654270250,C[1]),new a(2438529370,C[2]),new a(355462360,C[3]),new a(1731405415,C[4]),new a(41048885895,C[5]),new a(3675008525,C[6]),new a(1203062813,C[7])]:[new a(M[0],4089235720),new a(M[1],2227873595),new a(M[2],4271175723),new a(M[3],1595750129),new a(M[4],2917565137),new a(M[5],725511199),new a(M[6],4215389547),new a(M[7],327033209)]}function ne(r,e){let n,t,s,o,i,u,l,h,d,c,f,g;const p=[];for(n=e[0],t=e[1],s=e[2],o=e[3],i=e[4],u=e[5],l=e[6],h=e[7],f=0;f<80;f+=1)f<16?(g=2*f,p[f]=new a(r[g],r[g+1])):p[f]=$e(Ve(p[f-2]),p[f-7],We(p[f-15]),p[f-16]),d=Ge(h,Je(i),(b=u,y=l,new a((m=i).N&b.N^~m.N&y.N,m.I&b.I^~m.I&y.I)),Ze[f],p[f]),c=H(qe(n),ze(n,t,s)),h=l,l=u,u=i,i=H(o,d),o=s,s=t,t=n,n=H(d,c);var m,b,y;return e[0]=H(n,e[0]),e[1]=H(t,e[1]),e[2]=H(s,e[2]),e[3]=H(o,e[3]),e[4]=H(i,e[4]),e[5]=H(u,e[5]),e[6]=H(l,e[6]),e[7]=H(h,e[7]),e}let Qe=class extends Y{constructor(r,e,n){if(r!=="SHA-384"&&r!=="SHA-512")throw new Error(x);super(r,e,n);const t=n||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=_(this.t,this.i,this.T),this.v=ne,this.L=function(s){return s.slice()},this.B=te,this.F=function(s,o,i,u){return function(l,h,d,c,f){let g,p;const m=31+(h+129>>>10<<5),b=h+d;for(;l.length<=m;)l.push(0);for(l[h>>>5]|=128<<24-h%32,l[m]=4294967295&b,l[m-1]=b/D|0,g=0;g<l.length;g+=32)c=ne(l.slice(g,g+32),c);return p=f==="SHA-384"?[c[0].N,c[0].I,c[1].N,c[1].I,c[2].N,c[2].I,c[3].N,c[3].I,c[4].N,c[4].I,c[5].N,c[5].I]:[c[0].N,c[0].I,c[1].N,c[1].I,c[2].N,c[2].I,c[3].N,c[3].I,c[4].N,c[4].I,c[5].N,c[5].I,c[6].N,c[6].I,c[7].N,c[7].I],p}(s,o,i,u,r)},this.U=te(r),this.m=1024,this.R=r==="SHA-384"?384:512,this.K=!1,t.hmacKey&&this.k(U("hmacKey",t.hmacKey,this.T))}};const et=[new a(0,1),new a(0,32898),new a(2147483648,32906),new a(2147483648,2147516416),new a(0,32907),new a(0,2147483649),new a(2147483648,2147516545),new a(2147483648,32777),new a(0,138),new a(0,136),new a(0,2147516425),new a(0,2147483658),new a(0,2147516555),new a(2147483648,139),new a(2147483648,32905),new a(2147483648,32771),new a(2147483648,32770),new a(2147483648,128),new a(0,32778),new a(2147483648,2147483658),new a(2147483648,2147516545),new a(2147483648,32896),new a(0,2147483649),new a(2147483648,2147516424)],tt=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];function $(r){let e;const n=[];for(e=0;e<5;e+=1)n[e]=[new a(0,0),new a(0,0),new a(0,0),new a(0,0),new a(0,0)];return n}function nt(r){let e;const n=[];for(e=0;e<5;e+=1)n[e]=r[e].slice();return n}function O(r,e){let n,t,s,o;const i=[],u=[];if(r!==null)for(t=0;t<r.length;t+=2)e[(t>>>1)%5][(t>>>1)/5|0]=B(e[(t>>>1)%5][(t>>>1)/5|0],new a(r[t+1],r[t]));for(n=0;n<24;n+=1){for(o=$(),t=0;t<5;t+=1)i[t]=(l=e[t][0],h=e[t][1],d=e[t][2],c=e[t][3],f=e[t][4],new a(l.N^h.N^d.N^c.N^f.N,l.I^h.I^d.I^c.I^f.I));for(t=0;t<5;t+=1)u[t]=B(i[(t+4)%5],ee(i[(t+1)%5],1));for(t=0;t<5;t+=1)for(s=0;s<5;s+=1)e[t][s]=B(e[t][s],u[t]);for(t=0;t<5;t+=1)for(s=0;s<5;s+=1)o[s][(2*t+3*s)%5]=ee(e[t][s],tt[t][s]);for(t=0;t<5;t+=1)for(s=0;s<5;s+=1)e[t][s]=B(o[t][s],new a(~o[(t+1)%5][s].N&o[(t+2)%5][s].N,~o[(t+1)%5][s].I&o[(t+2)%5][s].I));e[0][0]=B(e[0][0],et[n])}var l,h,d,c,f;return e}function be(r){let e,n,t=0;const s=[0,0],o=[4294967295&r,r/D&2097151];for(e=6;e>=0;e--)n=o[e>>2]>>>8*e&255,n===0&&t===0||(s[t+1>>2]|=n<<8*(t+1),t+=1);return t=t!==0?t:1,s[0]|=t,{value:t+1>4?s:[s[0]],binLen:8+8*t}}function X(r){return j(be(r.binLen),r)}function se(r,e){let n,t=be(e);t=j(t,r);const s=e>>>2,o=(s-t.value.length%s)%s;for(n=0;n<o;n++)t.value.push(0);return t.value}let st=class extends Y{constructor(r,e,n){let t=6,s=0;super(r,e,n);const o=n||{};if(this.numRounds!==1){if(o.kmacKey||o.hmacKey)throw new Error(fe);if(this.o==="CSHAKE128"||this.o==="CSHAKE256")throw new Error("Cannot set numRounds for CSHAKE variants")}switch(this.T=1,this.C=_(this.t,this.i,this.T),this.v=O,this.L=nt,this.B=$,this.U=$(),this.K=!1,r){case"SHA3-224":this.m=s=1152,this.R=224,this.M=!0,this.g=this.Y;break;case"SHA3-256":this.m=s=1088,this.R=256,this.M=!0,this.g=this.Y;break;case"SHA3-384":this.m=s=832,this.R=384,this.M=!0,this.g=this.Y;break;case"SHA3-512":this.m=s=576,this.R=512,this.M=!0,this.g=this.Y;break;case"SHAKE128":t=31,this.m=s=1344,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"SHAKE256":t=31,this.m=s=1088,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"KMAC128":t=4,this.m=s=1344,this.X(n),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"KMAC256":t=4,this.m=s=1088,this.X(n),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"CSHAKE128":this.m=s=1344,t=this.O(n),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"CSHAKE256":this.m=s=1088,t=this.O(n),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;default:throw new Error(x)}this.F=function(i,u,l,h,d){return function(c,f,g,p,m,b,y){let v,E,A=0;const N=[],F=m>>>5,Ie=f>>>5;for(v=0;v<Ie&&f>=m;v+=F)p=O(c.slice(v,v+F),p),f-=m;for(c=c.slice(v),f%=m;c.length<F;)c.push(0);for(v=f>>>3,c[v>>2]^=b<<v%4*8,c[F-1]^=2147483648,p=O(c,p);32*N.length<y&&(E=p[A%5][A/5|0],N.push(E.I),!(32*N.length>=y));)N.push(E.N),A+=1,64*A%m==0&&(O(null,p),A=0);return N}(i,u,0,h,s,t,d)},o.hmacKey&&this.k(U("hmacKey",o.hmacKey,this.T))}O(r,e){const n=function(s){const o=s||{};return{funcName:U("funcName",o.funcName,1,{value:[],binLen:0}),customization:U("Customization",o.customization,1,{value:[],binLen:0})}}(r||{});e&&(n.funcName=e);const t=j(X(n.funcName),X(n.customization));if(n.customization.binLen!==0||n.funcName.binLen!==0){const s=se(t,this.m>>>3);for(let o=0;o<s.length;o+=this.m>>>5)this.U=this.v(s.slice(o,o+(this.m>>>5)),this.U),this.A+=this.m;return 4}return 31}X(r){const e=function(t){const s=t||{};return{kmacKey:U("kmacKey",s.kmacKey,1),funcName:{value:[1128353099],binLen:32},customization:U("Customization",s.customization,1,{value:[],binLen:0})}}(r||{});this.O(r,e.funcName);const n=se(X(e.kmacKey),this.m>>>3);for(let t=0;t<n.length;t+=this.m>>>5)this.U=this.v(n.slice(t,t+(this.m>>>5)),this.U),this.A+=this.m;this.H=!0}_(r){const e=j({value:this.h.slice(),binLen:this.u},function(n){let t,s,o=0;const i=[0,0],u=[4294967295&n,n/D&2097151];for(t=6;t>=0;t--)s=u[t>>2]>>>8*t&255,s===0&&o===0||(i[o>>2]|=s<<8*o,o+=1);return o=o!==0?o:1,i[o>>2]|=o<<8*o,{value:o+1>4?i:[i[0]],binLen:8+8*o}}(r.outputLen));return this.F(e.value,e.binLen,this.A,this.L(this.U),r.outputLen)}};class ye{constructor(e,n,t){if(e=="SHA-1")this.P=new Ye(e,n,t);else if(e=="SHA-224"||e=="SHA-256")this.P=new Xe(e,n,t);else if(e=="SHA-384"||e=="SHA-512")this.P=new Qe(e,n,t);else{if(e!="SHA3-224"&&e!="SHA3-256"&&e!="SHA3-384"&&e!="SHA3-512"&&e!="SHAKE128"&&e!="SHAKE256"&&e!="CSHAKE128"&&e!="CSHAKE256"&&e!="KMAC128"&&e!="KMAC256")throw new Error(x);this.P=new st(e,n,t)}}update(e){return this.P.update(e),this}getHash(e,n){return this.P.getHash(e,n)}setHMACKey(e,n,t){this.P.setHMACKey(e,n,t)}getHMAC(e,n){return this.P.getHMAC(e,n)}}class re{constructor(e=30,n=6){if(this.expiry=e,this.length=n,this.length>8||this.length<6)throw"Error: invalid code length"}dec2hex(e){return(e<15.5?"0":"")+Math.round(e).toString(16)}hex2dec(e){return parseInt(e,16)}base32tohex(e){var n,t,s,o,i,u;for(n="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",t="",o="",i=0;i<e.length;)u=n.indexOf(e.charAt(i).toUpperCase()),t+=this.leftpad(u.toString(2),5,"0"),i++;for(i=0;i+4<=t.length;)s=t.substr(i,4),o=o+parseInt(s,2).toString(16),i+=4;return o}leftpad(e,n,t){return n+1>=e.length&&(e=Array(n+1-e.length).join(t)+e),e}getOtp(e,n=new Date().getTime()){var t,s,o,i,u,l,h;if(o=this.base32tohex(e),t=Math.round(n/1e3),h=this.leftpad(this.dec2hex(Math.floor(t/this.expiry)),16,"0"),l=new ye("SHA-1","HEX"),l.setHMACKey(o,"HEX"),l.update(h),s=l.getHMAC("HEX"),s==="KEY MUST BE IN BYTE INCREMENTS")throw"Error: hex key must be in byte increments";return i=this.hex2dec(s.substring(s.length-1)),u=(this.hex2dec(s.substr(i*2,8))&this.hex2dec("7fffffff"))+"",u.length>this.length?u=u.substr(u.length-this.length,this.length):u=this.leftpad(u,this.length,"0"),u}}class rt{constructor(e=6){if(this.length=e,this.length>8||this.length<6)throw"Error: invalid code length"}uintToString(e){var n,t;return t=String.fromCharCode.apply(null,e),n=decodeURIComponent(escape(t)),n}getOtp(e,n){var t,s,o,i,u;return i=new ye("SHA-1","TEXT"),i.setHMACKey(e,"TEXT"),i.update(this.uintToString(new Uint8Array(this.intToBytes(n)))),t=i.getHMAC("HEX"),s=this.hexToBytes(t),o=s[19]&15,u=(s[o]&127)<<24|(s[o+1]&255)<<16|(s[o+2]&255)<<8|s[o+3]&255,u=u+"",u.substr(u.length-this.length,this.length)}intToBytes(e){var n,t;for(n=[],t=7;t>=0;)n[t]=e&255,e=e>>8,--t;return n}hexToBytes(e){var n,t,s;for(t=[],s=0,n=e.length;s<n;)t.push(parseInt(e.substr(s,2),16)),s+=2;return t}}const ot=`<div class="item" id="{ID}">
  <button class="edit-btn" title="Edit">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path d="M12 20h9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      <path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
  </button>
  <div class="issuer" title="{NAME}">{TITLE}</div>
  <textarea class="code" rows="1">{CODE}</textarea>
</div>`,it='<div class="code" title="ERRTITLE" style="color:red">#ERROR</div>';function at(r,e){let n=r.issuer||r.name,t=ot.replace(/\{TITLE\}/g,n).replace(/\{ID\}/g,r.id).replace(/\{NAME\}/g,r.name);typeof e=="string"?t=t.replace(/\{CODE\}/g,e):t=t.replace(/<textarea class="code".*?<\/textarea>/,it.replace("ERRTITLE",e.message||"Unknown error, check console.")),items.innerHTML+=t}function ct(){document.querySelectorAll(".item").forEach(r=>{r.addEventListener("click",function(e){const n=e.target.closest("button");if(n){dialogManager.show("edit-item",{id:n.closest("div").id});return}const t=this.querySelector(".code");if(t){t.focus(),t.select();try{var s=document.execCommand("copy"),o=s?"successful":"unsuccessful";console.log("Copy email command was "+o,t.innerText)}catch{console.log("Oops, unable to copy")}}})})}async function ve(r,e){const n=await appStorage.getData(r).catch(o=>(console.error(o),o.name=="OperationError"&&(e||alert("Invalid password")),Promise.reject(o)));if(!n)return;const t=new rt,s={6:new re(30,6),8:new re(30,8)};for(const o of n){if(!o){console.warn("Found null account",n);continue}let i;try{o.type===ce.HOTP?i=t.getOtp(o.secret,o.counter):o.digits in s?i=s[o.digits].getOtp(o.secret):console.warn("Unsupported digits",o.digits)}catch(u){console.log(o),console.error(u),i=u}at(o,i)}ct()}const lt=`<form id="password" class="form-card" onsubmit="return false">
  <label>
    Password: <input autofocus autocomplete="new-password" type="password" name="password">
  </label><br>
  <button type="submit">Submit</button>
</form>`;class ut{constructor(){I(this,"title","Input Password");I(this,"content",lt)}onShow(e){const n=e.body.querySelector("#password");n.addEventListener("submit",t=>{t.preventDefault(),ve(n.querySelector("[name=password]").value).then(()=>e.hide())})}}const ht=Object.freeze(Object.defineProperty({__proto__:null,default:ut},Symbol.toStringTag,{value:"Module"})),oe=Object.assign({"./dialogs/add-item.ts":Ne,"./dialogs/change-password.ts":Le,"./dialogs/edit-item.ts":Me,"./dialogs/import.ts":Be,"./dialogs/password.ts":ht}),K=Object.create(null);for(const r in oe){const e=r.match(/\/([^\/]+)\.ts$/);if(!e)continue;const n=e[1],t=oe[r].default;K[n]={class:t}}class ft{constructor(e="custom-dialog",n="dialog-title",t="dialog-body",s="dialog-close"){I(this,"overlay");I(this,"title");I(this,"body");I(this,"closeBtn");this.overlay=document.getElementById(e),this.title=document.getElementById(n),this.body=document.getElementById(t),this.closeBtn=document.getElementById(s),this.closeBtn.addEventListener("click",()=>this.hide()),this.overlay.addEventListener("click",o=>{o.target===this.overlay&&this.hide()})}dataEvents(){document.querySelectorAll("[data-dialog]").forEach(e=>{e.classList.contains("dialog-activator")||(e.addEventListener("click",n=>{this.show(e.dataset.dialog)}),e.classList.add("dialog-activator"))})}show(e,n){let t;if(typeof e=="string"){if(!(e in K)){console.error(`Dialog not found: ${e}`);return}K[e].instance||(K[e].instance=new K[e].class),t=K[e].instance}else t=e;this.title.textContent=t.title,this.body.innerHTML="",typeof t.content=="string"?this.body.innerHTML=t.content:this.body.appendChild(t.content),this.overlay.style.display="flex",t.onShow(this,n)}hide(){this.overlay.style.display="none"}}async function dt(r,e){const n=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",n),s=crypto.getRandomValues(new Uint8Array(12)),o={name:"AES-GCM",iv:s},i=await crypto.subtle.importKey("raw",t,o,!1,["encrypt"]),u=new TextEncoder().encode(r),l=await crypto.subtle.encrypt(o,i,u),d=Array.from(new Uint8Array(l)).map(g=>String.fromCharCode(g)).join(""),c=btoa(d);return Array.from(s).map(g=>("00"+g.toString(16)).slice(-2)).join("")+c}async function wt(r,e){const n=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",n),s=r.slice(0,24).match(/.{2}/g).map(l=>parseInt(l,16)),o={name:"AES-GCM",iv:new Uint8Array(s)},i=await crypto.subtle.importKey("raw",t,o,!1,["decrypt"]),u=atob(r.slice(24));if(u!==null){const l=new Uint8Array(u.match(/[\s\S]/g).map(c=>c.charCodeAt(0))),h=await crypto.subtle.decrypt(o,i,l);return new TextDecoder().decode(h)}return""}class pt{constructor(){I(this,"cached")}hasData(){return!!localStorage.data}async addItem(e,n){return e.id||(e.id=z()),this.addItems([e],n)}async removeItem(e,n){const t=this.cached.filter(s=>!!s).findIndex(s=>s.id==e);if(!(t<0))return this.cached.splice(t,1),this.setData(this.cached,n)}async replaceItem(e,n,t){const s=this.cached.filter(o=>!!o).findIndex(o=>o.id==e);if(!(s<0))return t.id=e,this.cached.splice(s,1,t),this.setData(this.cached,n)}async addItems(e,n){let t=[];return this.hasData()&&(t=await this.getData(n)),t.push(...e),this.setData(t,n)}changePassword(e,n){return this.getData(e).then(t=>this.setData(t,n))}setData(e,n){return dt(JSON.stringify(e.filter(t=>!!t)),n).then(t=>(localStorage.data=t,!0))}getData(e){return wt(localStorage.data,e).then(n=>{if(n[0]!="["){let t=atob(n);const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i);const o=ae(s);return console.warn("Migrating old data to new object",o),this.setData(o,e),this.cached=o}return this.cached=JSON.parse(n)})}validateItem(e){if(typeof e!="object"||!e)throw new Error("Invalid object");if(!e.secret)throw new Error("Empty secret");const n={name:e.name.toString(),issuer:e.issuer.toString(),secret:e.secret.toString(),digits:e.digits?parseInt(e.digits.toString()):void 0,counter:e.counter?parseInt(e.counter.toString()):void 0};if(e.algorithm in q)n.algorithm=parseInt(e.algorithm.toString());else throw new Error("Invalid algorithm");if(e.type in q)n.type=parseInt(e.type.toString());else throw new Error("Invalid type");return n.id=e.id||z(),n}async createItem(e,n){const t=this.validateItem(e);return await appStorage.addItem(t,n).catch(s=>Promise.reject(new Error("Invalid password"))),t}async updateItem(e,n,t){const s=this.validateItem(n);return await appStorage.replaceItem(e,t,s).catch(o=>(console.error(o),Promise.reject(new Error("Invalid password")))),s}}window.appStorage=new pt;window.dialogManager=new ft;document.addEventListener("DOMContentLoaded",()=>{dialogManager.dataEvents(),ve("",!0).catch(r=>{r.name=="OperationError"?dialogManager.show("password"):alert(r.message||r)})});
